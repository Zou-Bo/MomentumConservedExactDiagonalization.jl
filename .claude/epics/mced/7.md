---
id: "momentum-conserved-ed-007"
title: "Twisted Boundary Conditions: Magnetic Flux Threading and Spectrum Flow"
epic: "momentum-conserved-ed"
status: "pending"
priority: "medium"
dependencies: ["momentum-conserved-ed-001", "momentum-conserved-ed-002", "momentum-conserved-ed-003"]
estimated_hours: 8
complexity: "medium"
tags: ["twisted-boundary", "magnetic-flux", "hofstadter", "spectrum-flow"]
---

# Task: Twisted Boundary Conditions - Magnetic Flux Threading and Spectrum Flow

## Objective
Implement twisted boundary conditions to simulate magnetic flux threading through the system, enabling study of Hofstadter butterfly physics and spectrum flow under flux insertion.

## Requirements
- [ ] Implement twisted boundary conditions with tunable flux Φ per plaquette
- [ ] Add magnetic translation operators compatible with momentum conservation
- [ ] Implement flux insertion protocol (Φ → Φ + 2π)
- [ ] Compute spectrum flow and track level crossings
- [ ] Validate against Hofstadter butterfly for square lattice
- [ ] Support both rational and irrational flux values
- [ ] Add gauge field configuration options (Landau vs symmetric gauge)

## Technical Details
- Extend momentum-space Hamiltonian with Peierls substitution phases
- Implement magnetic Brillouin zone folding for rational flux
- Track Berry phase accumulation during flux insertion
- Handle Hofstadter butterfly fractal spectrum structure

## Acceptance Criteria
- [ ] Exact diagonalization reproduces Hofstadter spectrum for simple cases
- [ ] Spectrum flow shows quantized charge pumping (Thouless pumping)
- [ ] Level crossings follow predicted statistics
- [ ] Performance comparable to standard momentum-conserved ED
- [ ] Comprehensive test suite with known exact results

## Dependencies
- momentum-conserved-ed-001 (Core Momentum Conservation)
- momentum-conserved-ed-002 (Basis Construction)
- momentum-conserved-ed-003 (Hamiltonian Construction)

## Estimated Effort: 5-7 days