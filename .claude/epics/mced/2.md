---
name: Core EDPara Struct
status: open
created: 2025-09-05T20:01:57Z
updated: 2025-09-05T20:01:57Z
github: https://github.com/Zou-Bo/MomentumConservedExactDiagonalization.jl/issues/3
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Core EDPara Struct - Migrate Existing Parameter Container

## Description
Migrate the existing complex EDPara struct from ExactDiagonalization.jl into the new package. The current implementation has 9 fields with sophisticated validation, complex indexing schemes, and mature functionality that must be preserved exactly.

## Acceptance Criteria
- [ ] Migrate existing `@kwdef mutable struct EDPara` with all 9 fields intact
- [ ] Preserve exact field structure: `Gk`, `k_list`, `Nk`, `Nc_hopping`, `Nc_conserve`, `Nc`, `error`, `H_onebody`, `V_int`
- [ ] Maintain existing orbital indexing formula: `i = ik + Nk * (ic-1) + (Nk * Nc_hopping) * (icc-1)`
- [ ] Keep built-in validation: `Nc > 0` and `Nk*Nc <= 64` constraints
- [ ] Preserve default value calculations and field interdependencies
- [ ] Migrate all existing constructor patterns and multiple dispatch methods
- [ ] Transfer comprehensive test suite covering edge cases and validation
- [ ] Ensure backward compatibility with existing 700+ lines of dependent code

## Technical Details

### Current EDPara Structure (ExactDiagonalization.jl:32-61)
```julia
@kwdef mutable struct EDPara
    Gk::Tuple{Int64, Int64} = (0, 0)  # Momentum conservation mod G
    k_list::Matrix{Int64}             # k_list[:, i] = (k_x, k_y)
    Nk::Int64 = size(k_list,2)        # Number of momentum states
    Nc_hopping::Int64 = 1             # Components with hopping
    Nc_conserve::Int64 = 1            # Components with conserved quantum numbers
    Nc::Int64 = Nc_hopping * Nc_conserve  # Total components
    error = begin
        @assert Nc > 0 "Number of components must be positive"
        @assert Nk*Nc <= 64 "The Hilbert space dimension must not exceed 64 bits."
        nothing
    end
    H_onebody::Array{ComplexF64,4} = zeros(ComplexF64, Nc_hopping, Nc_hopping, Nc_conserve, Nk)
    V_int::Function = (kf1, kf2, ki1, ki2, cf1, cf2, ci1, ci2) -> ComplexF64(1.0)
end
```

### Critical Implementation Notes
- **Complex Indexing**: The orbital indexing formula is used throughout the codebase
- **Field Interdependencies**: `Nk` depends on `k_list`, `Nc` depends on component counts
- **Built-in Validation**: Error field executes during construction
- **Function Field**: `V_int` stores interaction potential as callable
- **Memory Constraint**: 64-bit limit for MBS64 compatibility

### Migration Requirements
- Copy implementation exactly from existing codebase
- Preserve all field types and default values
- Maintain exact validation logic and error messages
- Keep mutable struct design for parameter updates
- Ensure compatibility with existing MBS64 state management

### Files to Create/Modify
- `src/parameters.jl`: Main EDPara struct (single file implementation)
- `test/test_parameters.jl`: Comprehensive validation tests

## Dependencies
- [ ] Task 001.md - Package Foundation (provides project structure)
- [ ] Access to ExactDiagonalization.jl source code

## Effort Estimate
- Size: S (Small)
- Hours: 2 hours
- Parallel: true (simple migration task)

## Definition of Done
- [ ] EDPara struct copied exactly with all 9 fields
- [ ] All validation logic preserved and working
- [ ] Existing tests pass without modification
- [ ] Code review confirms exact functionality preservation
