---
name: Hamiltonian Scattering Lists
status: open
created: 2025-09-05T20:01:57Z
updated: 2025-09-05T20:01:57Z
github: https://github.com/Zou-Bo/MomentumConservedExactDiagonalization.jl/issues/5
depends_on: [001, 002]
parallel: true
conflicts_with: []
---

# Task: Hamiltonian Scattering Lists - Generate One-Body and Two-Body Scattering Terms

## Description
Create the scattering list generation system that produces the Hamiltonian terms from EDPara. This includes defining the Scattering type and generating lists of one-body and two-body scattering processes that conserve momentum and other quantum numbers. Only upper triangle matrix elements should be generated for efficiency.

## Acceptance Criteria
- [ ] Define `Scattering` struct to represent individual scattering processes
- [ ] Implement one-body scattering list generation from `H_onebody` array in EDPara
- [ ] Implement two-body scattering list generation using `V_int` function in EDPara
- [ ] Ensure momentum conservation: `kf1 + kf2 = ki1 + ki2` (mod G)
- [ ] Generate only upper triangle elements to avoid duplicate matrix entries
- [ ] Handle component conservation for `Nc_conserve` quantum numbers
- [ ] Optimize scattering list generation for performance
- [ ] Create comprehensive tests validating all scattering processes
- [ ] Ensure compatibility with existing orbital indexing formula

## Technical Details

### Scattering Type Definition
```julia
struct Scattering1Body
    i::Int64  # Initial orbital index
    f::Int64  # Final orbital index
    amp::ComplexF64  # Scattering amplitude
end

struct Scattering2Body
    i1::Int64  # Initial orbital 1
    i2::Int64  # Initial orbital 2
    f1::Int64  # Final orbital 1
    f2::Int64  # Final orbital 2
    amp::ComplexF64  # Scattering amplitude
end
```

### One-Body Scattering Generation
- **Input**: `H_onebody[cf, ci, cc, k]` from EDPara
- **Process**: Convert 4D array to list of `Scattering1Body` terms
- **Conservation**: Energy and component quantum numbers
- **Optimization**: Skip zero amplitude terms

### Two-Body Scattering Generation
- **Input**: `V_int(kf1, kf2, ki1, ki2, cf1, cf2, ci1, ci2)` function from EDPara
- **Process**: Evaluate function for all momentum-conserving combinations
- **Conservation**: `kf1 + kf2 = ki1 + ki2` (mod G) and component conservation
- **Optimization**: Precompute and cache results

### Upper Triangle Optimization
- **Hermiticity**: Generate only `i <= j` elements for Hermitian matrices
- **Efficiency**: Reduce memory usage and computation time
- **Completeness**: Ensure all unique matrix elements are covered

### Orbital Indexing Integration
Use existing formula: `i = ik + Nk * (ic-1) + (Nk * Nc_hopping) * (icc-1)`
- Map momentum and component indices to orbital positions
- Ensure consistency with EDPara parameter definitions

### Files to Create
- `src/scattering.jl`: Scattering type definitions and generation functions (single file)
- `test/test_scattering.jl`: Comprehensive scattering list tests

### Performance Considerations
- **Precomputation**: Cache frequently used scattering terms
- **Sparse Generation**: Skip zero-amplitude processes
- **Memory Efficiency**: Store only non-zero scattering elements
- **Type Stability**: Ensure concrete types for hot loops

### Validation Requirements
- **Momentum Conservation**: Verify `kf1 + kf2 = ki1 + ki2` for all 2-body terms
- **Component Conservation**: Check quantum number preservation
- **Hermiticity**: Ensure upper triangle generation maintains Hermitian structure
- **Completeness**: Validate all possible scattering processes are considered

## Dependencies
- [ ] Task 001.md - Package Foundation (provides project structure)
- [ ] Task 002.md - Core EDPara Struct (required for Hamiltonian parameters)
- [ ] Access to ExactDiagonalization.jl scattering implementation

## Effort Estimate
- Size: M (Medium)
- Hours: 4 hours
- Parallel: true (independent of basis generation)

## Definition of Done
- [ ] Scattering types defined with proper field structure
- [ ] One-body scattering list generation working correctly
- [ ] Two-body scattering list generation with momentum conservation
- [ ] Upper triangle optimization implemented
- [ ] Comprehensive tests validate all scattering processes
- [ ] Performance benchmarks show efficient generation
- [ ] Code review confirms mathematical correctness
