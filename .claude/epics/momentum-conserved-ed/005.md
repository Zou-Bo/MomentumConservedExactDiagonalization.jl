---
title: "Diagonalization Engine: Efficient Eigensolvers"
epic: "momentum-conserved-ed"
task_id: 005
status: "pending"
priority: "high"
depends_on: [001, 002, 003, 004]
estimated_hours: 15
complexity: "high"
tags: ["diagonalization", "eigensolver", "lanczos", "davidson", "momentum-conservation"]
---

# Diagonalization Engine: Add efficient eigensolvers with momentum conservation

## Overview
Implement state-of-the-art iterative eigensolvers (Lanczos, Davidson, LOBPCG) optimized for momentum-conserved Hamiltonians, exploiting block-diagonal structure for memory efficiency and parallel computation of momentum sectors.

## Acceptance Criteria

### Core Algorithms
- [ ] Implement Lanczos algorithm for ground state and low-lying excited states
- [ ] Implement Davidson algorithm for interior eigenvalues and degenerate spectra
- [ ] Support both real and complex arithmetic for momentum eigenstates
- [ ] Handle degenerate eigenvalues correctly across momentum sectors
- [ ] Implement restart strategies for memory-constrained environments

### Performance & Scalability
- [ ] Compute ground state energy for 20-site Heisenberg chain in < 30 seconds
- [ ] Memory usage O(N路2^N) instead of O(4^N) for full diagonalization
- [ ] Parallel computation across independent momentum sectors
- [ ] Support for computing multiple eigenvalues (ground state + excited states)
- [ ] Efficient preconditioning for Davidson algorithm

### Accuracy & Validation
- [ ] Energy accuracy to machine precision (1e-15 relative error)
- [ ] Orthogonality of eigenvectors within numerical precision
- [ ] Correct handling of degenerate eigenvalues
- [ ] Validation against exact diagonalization for small systems
- [ ] Cross-validation with known Bethe ansatz results for integrable models

### Interface Design
- [ ] Clean API for requesting specific eigenvalues (ground state, first N excited)
- [ ] Support for computing expectation values of observables
- [ ] Efficient state vector operations (norm, overlap, expectation values)
- [ ] Progress monitoring and convergence diagnostics

## Technical Details

### Algorithm Architecture

#### 1. Lanczos Algorithm for Sparse Matrices
```julia
struct LanczosSolver
    max_iter::Int
    tol::Float64
    reorthogonalize::Bool
    krylov_dim::Int
end

function lanczos_diagonalize(hamiltonian_blocks, k_target::Int, nev::Int=1)
    # Solve for momentum sector k_target
    H_k = hamiltonian_blocks[k_target].hamiltonian
    
    # Lanczos iteration with reorthogonalization
    T, Q = lanczos_iteration(H_k, krylov_dim=max_iter)
    
    # Diagonalize tridiagonal matrix
    eigenvalues, eigenvectors = eigen(T)
    
    # Transform back to original basis
    states = Q * eigenvectors[:, 1:nev]
    
    return eigenvalues[1:nev], states
end
```

#### 2. Davidson Algorithm for Interior Eigenvalues
```julia
struct DavidsonSolver
    max_iter::Int
    tol::Float64
    subspace_size::Int
    preconditioner::PreconditionerType
end

function davidson_diagonalize(hamiltonian_blocks, k_target::Int, energy_window::Tuple{Float64,Float64})
    # Davidson iteration with subspace expansion
    # Target eigenvalues within energy_window
    # Use preconditioning for faster convergence
end
```

### Momentum-Sector Parallelization
- **Independent Blocks**: Each momentum sector can be diagonalized separately
- **Parallel Execution**: Use Julia's multi-threading across k-sectors
- **Load Balancing**: Handle varying block sizes efficiently
- **Memory Sharing**: Share basis states across threads when possible

### Advanced Features

#### 1. Targeted Diagonalization
- **Energy Windows**: Compute eigenvalues within specific energy ranges
- **Momentum Filtering**: Select specific momentum sectors
- **State Constraints**: Target states with specific quantum numbers

#### 2. Convergence Acceleration
- **Preconditioning**: Use diagonal elements as preconditioner
- **Restart Strategies**: Handle memory constraints with implicit restart
- **Deflation**: Remove converged eigenvalues for interior eigenvalue computation

#### 3. State Manipulation
- **Expectation Values**: Efficient computation of observables
- **State Overlaps**: Compute overlaps between different states
- **Time Evolution**: Apply time evolution operators using Krylov subspaces

### Implementation Strategy

#### 1. Core Iterative Methods
- **Matrix-Free Operations**: Use Hamiltonian as linear operator
- **Krylov Subspace Methods**: Leverage sparse matrix-vector products
- **Numerical Stability**: Careful reorthogonalization and convergence checks

#### 2. Momentum Conservation Exploitation
- **Block Diagonal Structure**: Solve each momentum sector independently
- **Parallel Processing**: Multi-thread diagonalization across k-sectors
- **Memory Efficiency**: Only store active Krylov vectors

#### 3. Error Handling & Recovery
- **Convergence Monitoring**: Detect and report non-convergence
- **Memory Management**: Graceful handling of memory exhaustion
- **Numerical Issues**: Handle near-degenerate eigenvalues robustly

## Performance Considerations
- **Memory Scaling**: O(N路2^N) memory usage vs O(4^N) for dense methods
- **Time Scaling**: O(N路iter路2^N) vs O(8^N) for dense diagonalization
- **Parallel Efficiency**: Near-linear scaling with number of momentum sectors
- **Cache Optimization**: Efficient matrix-vector multiplication patterns

## Dependencies
- Task 004 (Hamiltonian Builder) for sparse matrix construction
- LinearAlgebra.jl for eigenvalue computations
- SparseArrays.jl for sparse matrix operations
- Arpack.jl or KrylovKit.jl for advanced iterative methods

## Testing Strategy
- **Unit Tests**: Test individual algorithms on small matrices
- **Integration Tests**: Full diagonalization pipeline validation
- **Performance Tests**: Benchmark against known exact results
- **Accuracy Tests**: Verify precision against analytical solutions

## Files to Create/Modify
- `src/diagonalization/lanczos.jl` - Lanczos algorithm implementation
- `src/diagonalization/davidson.jl` - Davidson algorithm implementation
- `src/diagonalization/eigensolvers.jl` - Unified solver interface
- `src/diagonalization/convergence.jl` - Convergence monitoring
- `test/diagonalization/test_eigensolvers.jl` - Comprehensive test suite
- `benchmarks/diagonalization_performance.jl` - Performance benchmarks